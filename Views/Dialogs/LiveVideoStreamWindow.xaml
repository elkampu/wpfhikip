<Window x:Class="wpfhikip.Views.Dialogs.LiveVideoStreamWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vlc="clr-namespace:LibVLCSharp.WPF;assembly=LibVLCSharp.WPF"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}"
        Height="600"
        Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        MinHeight="400"
        MinWidth="600">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

        <Style x:Key="ModernButtonStyle"
               TargetType="Button">
            <Setter Property="Padding"
                    Value="12,8" />
            <Setter Property="Margin"
                    Value="4" />
            <Setter Property="FontWeight"
                    Value="Medium" />
            <Setter Property="FontSize"
                    Value="14" />
            <Setter Property="Cursor"
                    Value="Hand" />
            <Setter Property="BorderThickness"
                    Value="0" />
        </Style>

        <Style x:Key="PrimaryButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="Background"
                    Value="{StaticResource SEC_MidBlue}" />
            <Setter Property="Foreground"
                    Value="{StaticResource SEC_White}" />
        </Style>

        <Style x:Key="SuccessButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="Background"
                    Value="#16a34a" />
            <Setter Property="Foreground"
                    Value="White" />
        </Style>

        <Style x:Key="DangerButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="Background"
                    Value="#dc3545" />
            <Setter Property="Foreground"
                    Value="White" />
        </Style>
    </Window.Resources>

    <Grid Background="#f8fafc">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="{StaticResource SEC_White}"
                BorderBrush="{StaticResource SEC_LightGrey}"
                BorderThickness="0,0,0,1">
            <Grid Margin="16,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="{Binding Title}"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="{StaticResource SEC_DarkGrey}" />
                    <TextBlock Text="{Binding Subtitle}"
                               FontSize="12"
                               Foreground="{StaticResource SEC_MidGrey}" />
                </StackPanel>

                <StackPanel Grid.Column="1"
                            Orientation="Horizontal">
                    <ComboBox ItemsSource="{Binding StreamOptions}"
                              SelectedItem="{Binding SelectedStreamOption}"
                              DisplayMemberPath="DisplayName"
                              Width="120"
                              Margin="0,0,8,0"
                              VerticalAlignment="Center" />

                    <Button Content="🔄"
                            Command="{Binding RefreshCommand}"
                            Style="{StaticResource SuccessButtonStyle}"
                            ToolTip="Refresh Stream"
                            Visibility="{Binding IsConnected, Converter={StaticResource BooleanToVisibilityConverter}}" />

                    <Button Content="⏸️"
                            Command="{Binding PauseCommand}"
                            Style="{StaticResource PrimaryButtonStyle}"
                            ToolTip="Pause Stream"
                            Visibility="{Binding IsPlaying, Converter={StaticResource BooleanToVisibilityConverter}}" />

                    <Button Content="▶️"
                            Command="{Binding PlayCommand}"
                            Style="{StaticResource SuccessButtonStyle}"
                            ToolTip="Play Stream"
                            Visibility="{Binding IsPaused, Converter={StaticResource BooleanToVisibilityConverter}}" />

                    <Button Content="⏹️"
                            Command="{Binding StopCommand}"
                            Style="{StaticResource DangerButtonStyle}"
                            ToolTip="Stop Stream"
                            Visibility="{Binding IsConnected, Converter={StaticResource BooleanToVisibilityConverter}}" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Video Content -->
        <Grid Grid.Row="1"
              Margin="16">
            <!-- Loading State -->
            <Border Background="#dbeafe"
                    BorderBrush="#3b82f6"
                    BorderThickness="2"
                    CornerRadius="8"
                    Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                    <TextBlock Text="🔄"
                               FontSize="48"
                               HorizontalAlignment="Center">
                        <TextBlock.RenderTransform>
                            <RotateTransform x:Name="LoadingRotation" />
                        </TextBlock.RenderTransform>
                        <TextBlock.Triggers>
                            <EventTrigger RoutedEvent="Loaded">
                                <BeginStoryboard>
                                    <Storyboard RepeatBehavior="Forever">
                                        <DoubleAnimation Storyboard.TargetName="LoadingRotation"
                                                         Storyboard.TargetProperty="Angle"
                                                         From="0"
                                                         To="360"
                                                         Duration="0:0:2" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </TextBlock.Triggers>
                    </TextBlock>
                    <TextBlock Text="{Binding StatusMessage}"
                               FontSize="16"
                               FontWeight="Medium"
                               Foreground="#1e40af"
                               HorizontalAlignment="Center"
                               Margin="0,16,0,0" />
                </StackPanel>
            </Border>

            <!-- Error State -->
            <Border Background="#fee2e2"
                    BorderBrush="#ef4444"
                    BorderThickness="2"
                    CornerRadius="8"
                    Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Margin="32">
                    <TextBlock Text="⚠️"
                               FontSize="48"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="Stream Connection Failed"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="#dc2626"
                               HorizontalAlignment="Center"
                               Margin="0,16,0,8" />
                    <TextBlock Text="{Binding ErrorMessage}"
                               FontSize="14"
                               Foreground="#991b1b"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               MaxWidth="400" />
                    <Button Content="📋 Copy Stream URL"
                            Command="{Binding CopyStreamUrlCommand}"
                            Style="{StaticResource PrimaryButtonStyle}"
                            Margin="0,16,0,0" />
                </StackPanel>
            </Border>

            <Border Background="Black"
                    CornerRadius="8"
                    Visibility="{Binding ShowVideoPlayer, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid>
                    <!-- VLC VideoView with Viewbox for stretch control -->
                    <Viewbox Stretch="Uniform">
                        <vlc:VideoView x:Name="VideoPlayer"
                                       MediaPlayer="{Binding MediaPlayer}"
                                       Width="800"
                                       Height="600"
                                       Loaded="VideoPlayer_Loaded" />
                    </Viewbox>

                    <!-- Video overlay controls -->
                    <Grid VerticalAlignment="Bottom"
                          Background="#80000000"
                          Height="40">
                        <StackPanel Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Margin="12,0">
                            <TextBlock Text="{Binding CurrentStreamUrl}"
                                       Foreground="White"
                                       FontFamily="Consolas"
                                       FontSize="10"
                                       VerticalAlignment="Center"
                                       TextTrimming="CharacterEllipsis" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>

            <!-- Default State -->
            <Border Background="#f3f4f6"
                    BorderBrush="#d1d5db"
                    BorderThickness="2"
                    CornerRadius="8"
                    Visibility="{Binding ShowDefaultState, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                    <TextBlock Text="📹"
                               FontSize="64"
                               HorizontalAlignment="Center"
                               Opacity="0.5" />
                    <TextBlock Text="Live Video Stream"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="{StaticResource SEC_MidGrey}"
                               HorizontalAlignment="Center"
                               Margin="0,16,0,8" />
                    <TextBlock Text="Select a stream option and click play to begin"
                               FontSize="14"
                               Foreground="{StaticResource SEC_MidGrey}"
                               HorizontalAlignment="Center" />
                    <Button Content="▶️ Start Stream"
                            Command="{Binding PlayCommand}"
                            Style="{StaticResource SuccessButtonStyle}"
                            FontSize="16"
                            Padding="20,12"
                            Margin="0,20,0,0" />
                </StackPanel>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="{StaticResource SEC_White}"
                BorderBrush="{StaticResource SEC_LightGrey}"
                BorderThickness="0,1,0,0">
            <Grid Margin="16,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0"
                            Orientation="Horizontal"
                            VerticalAlignment="Center">
                    <Ellipse Width="8"
                             Height="8"
                             Margin="0,0,8,0">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill"
                                        Value="#6b7280" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsConnected}"
                                                 Value="True">
                                        <Setter Property="Fill"
                                                Value="#16a34a" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding HasError}"
                                                 Value="True">
                                        <Setter Property="Fill"
                                                Value="#ef4444" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                    <TextBlock Text="{Binding StatusMessage}"
                               FontSize="12"
                               Foreground="{StaticResource SEC_DarkGrey}"
                               VerticalAlignment="Center" />
                </StackPanel>

                <Button Grid.Column="1"
                        Content="❌ Close"
                        Command="{Binding CloseCommand}"
                        Style="{StaticResource PrimaryButtonStyle}" />
            </Grid>
        </Border>
    </Grid>
</Window>
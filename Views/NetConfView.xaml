<Window x:Class="wpfhikip.Views.NetConfView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:wpfhikip.Views"
        xmlns:controls="clr-namespace:wpfhikip.Controls"
        xmlns:viewModel="clr-namespace:wpfhikip.ViewModels"
        xmlns:converters="clr-namespace:wpfhikip.Converters"
        mc:Ignorable="d"
        Title="Network Configuration Manager"
        Height="900"
        Width="1400"
        WindowStartupLocation="CenterScreen">
    <Window.DataContext>
        <viewModel:NetConfViewModel />
    </Window.DataContext>
    <Window.Resources>
        <!-- Add the converters -->
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
        <converters:EnumToStringConverter x:Key="EnumToStringConverter" />
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Window.Resources>

    <Grid Background="#f8fafc">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="{StaticResource SEC_White}"
                BorderBrush="{StaticResource SEC_LightGrey}"
                BorderThickness="0,0,0,1">
            <Grid Margin="24,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Network Configuration Manager"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="{StaticResource SEC_DarkGrey}" />
                    <TextBlock Text="Configure network settings for multiple cameras simultaneously"
                               FontSize="14"
                               Foreground="{StaticResource SEC_MidGrey}"
                               Margin="0,4,0,0" />
                </StackPanel>

                <StackPanel Grid.Column="1"
                            Orientation="Horizontal">
                    <Button Content="💾 Save Config"
                            Command="{Binding SaveConfigCommand}"
                            Style="{StaticResource SecondaryButtonStyle}" />
                    <Button Content="📁 Load Config"
                            Command="{Binding LoadConfigCommand}"
                            Style="{StaticResource SecondaryButtonStyle}" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1"
              Margin="24,16">
            <Border Style="{StaticResource ModernCardStyle}"
                    Margin="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Content Header -->
                    <Grid Grid.Row="0"
                          Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                                   Text="Cameras"
                                   Style="{StaticResource SectionTitleStyle}"
                                   Margin="0" />

                        <StackPanel Grid.Column="1"
                                    Orientation="Horizontal">
                            <Button x:Name="addButton"
                                    Content="➕ Add Camera"
                                    Command="{Binding AddCameraCommand}"
                                    Style="{StaticResource PrimaryButtonStyle}" />
                            <Button x:Name="deleteButton"
                                    Content="🗑️ Delete"
                                    Command="{Binding DeleteSelectedCommand}"
                                    Style="{StaticResource DangerButtonStyle}" />
                            <Button x:Name="selectAllButton"
                                    Content="☑️ Select All"
                                    Command="{Binding SelectAllCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}" />
                        </StackPanel>
                    </Grid>

                    <!-- DataGrid Container -->
                    <ScrollViewer Grid.Row="1"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Auto">
                        <DataGrid x:Name="dataGrid"
                                  Style="{StaticResource ModernDataGridStyle}"
                                  ItemsSource="{Binding Cameras, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  PreviewKeyDown="DataGrid_PreviewKeyDown"
                                  BeginningEdit="DataGrid_BeginningEdit">
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Setter Property="Background"
                                            Value="{Binding RowColor}" />
                                </Style>
                            </DataGrid.RowStyle>
                            <DataGrid.Columns>
                                <!-- Select Column -->
                                <DataGridTemplateColumn Header="☑"
                                                        Width="35"
                                                        MinWidth="35"
                                                        MaxWidth="35">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <!-- Protocol Column -->
                                <DataGridTemplateColumn Header="Protocol"
                                                        Width="80"
                                                        MinWidth="80"
                                                        MaxWidth="80">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Protocol, Converter={StaticResource EnumToStringConverter}}"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontSize="12" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <ComboBox SelectedValue="{Binding Protocol, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      ItemsSource="{Binding Path=DataContext.ProtocolOptions, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                                                      FontSize="12"
                                                      HorizontalContentAlignment="Center">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Converter={StaticResource EnumToStringConverter}}" />
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- Current IP with custom IP control -->
                                <DataGridTemplateColumn Header="Current IP"
                                                        Width="110"
                                                        MinWidth="110"
                                                        MaxWidth="110">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding CurrentIP}"
                                                       FontWeight="{Binding CellFontWeight}"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontSize="12" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <controls:IpAddressControl IpAddress="{Binding CurrentIP, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- Custom Port Column -->
                                <DataGridTextColumn Header="Port"
                                                    Width="50"
                                                    MinWidth="50"
                                                    MaxWidth="50"
                                                    Binding="{Binding Port}">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment"
                                                    Value="Center" />
                                            <Setter Property="VerticalAlignment"
                                                    Value="Center" />
                                            <Setter Property="FontSize"
                                                    Value="12" />
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                    <DataGridTextColumn.EditingElementStyle>
                                        <Style TargetType="TextBox">
                                            <Setter Property="HorizontalContentAlignment"
                                                    Value="Center" />
                                            <Setter Property="VerticalContentAlignment"
                                                    Value="Center" />
                                            <Setter Property="FontSize"
                                                    Value="12" />
                                        </Style>
                                    </DataGridTextColumn.EditingElementStyle>
                                </DataGridTextColumn>

                                <!-- New IP with custom IP control -->
                                <DataGridTemplateColumn Header="Target IP"
                                                        Width="110"
                                                        MinWidth="110"
                                                        MaxWidth="110">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding NewIP}"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontSize="12" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <controls:IpAddressControl IpAddress="{Binding NewIP, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- New Mask with custom IP control -->
                                <DataGridTemplateColumn Header="Target Mask"
                                                        Width="110"
                                                        MinWidth="110"
                                                        MaxWidth="110">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding NewMask}"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontSize="12" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <controls:IpAddressControl IpAddress="{Binding NewMask, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- New Gateway with custom IP control -->
                                <DataGridTemplateColumn Header="Target Gateway"
                                                        Width="110"
                                                        MinWidth="110"
                                                        MaxWidth="110">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding NewGateway}"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontSize="12" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <controls:IpAddressControl IpAddress="{Binding NewGateway, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- DNS1 with custom IP control -->
                                <DataGridTemplateColumn Header="Target Primary DNS"
                                                        Width="110"
                                                        MinWidth="110"
                                                        MaxWidth="110">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding NewDNS1}"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontSize="12" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <controls:IpAddressControl IpAddress="{Binding NewDNS1, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- DNS2 with custom IP control -->
                                <DataGridTemplateColumn Header="Target Secondary DNS"
                                                        Width="110"
                                                        MinWidth="110"
                                                        MaxWidth="110">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding NewDNS2}"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontSize="12" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <controls:IpAddressControl IpAddress="{Binding NewDNS2, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- New NTP Server with custom IP control -->
                                <DataGridTemplateColumn Header="NTP"
                                                        Width="110"
                                                        MinWidth="110"
                                                        MaxWidth="110">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding NewNTPServer}"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontSize="12" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <controls:IpAddressControl IpAddress="{Binding NewNTPServer, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>

                                <!-- User Column -->
                                <DataGridTextColumn Header="User"
                                                    Width="60"
                                                    MinWidth="60"
                                                    MaxWidth="60"
                                                    Binding="{Binding Username}">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment"
                                                    Value="Center" />
                                            <Setter Property="VerticalAlignment"
                                                    Value="Center" />
                                            <Setter Property="FontSize"
                                                    Value="12" />
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <!-- Password Column -->
                                <DataGridTextColumn Header="Pass"
                                                    Width="60"
                                                    MinWidth="60"
                                                    MaxWidth="60"
                                                    Binding="{Binding Password}">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment"
                                                    Value="Center" />
                                            <Setter Property="VerticalAlignment"
                                                    Value="Center" />
                                            <Setter Property="FontSize"
                                                    Value="12" />
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <!-- Net Info Column -->
                                <DataGridTemplateColumn Header="Info"
                                                        Width="70"
                                                        MinWidth="70"
                                                        MaxWidth="70"
                                                        IsReadOnly="True">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="Info"
                                                    Click="CameraInfoButton_Click"
                                                    Tag="{Binding}"
                                                    ToolTip="Click to view camera information"
                                                    HorizontalAlignment="Stretch"
                                                    VerticalAlignment="Stretch"
                                                    IsEnabled="{Binding CanShowCameraInfo}">
                                                <Button.Style>
                                                    <Style TargetType="Button"
                                                           BasedOn="{StaticResource StatusButtonStyle}">
                                                        <Style.Triggers>
                                                            <!-- Disabled state -->
                                                            <Trigger Property="IsEnabled"
                                                                     Value="False">
                                                                <Setter Property="Background"
                                                                        Value="{StaticResource SEC_LightGrey}" />
                                                                <Setter Property="Foreground"
                                                                        Value="{StaticResource SEC_MidGrey}" />
                                                                <Setter Property="BorderBrush"
                                                                        Value="{StaticResource SEC_MidGrey}" />
                                                            </Trigger>
                                                            <!-- Enabled state with green color when camera info can be shown -->
                                                            <DataTrigger Binding="{Binding CanShowCameraInfo}"
                                                                         Value="True">
                                                                <Setter Property="Background"
                                                                        Value="#FF4CAF50" />
                                                                <Setter Property="Foreground"
                                                                        Value="White" />
                                                                <Setter Property="BorderBrush"
                                                                        Value="#FF45A049" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <!-- Status Column with button-like appearance -->
                                <DataGridTemplateColumn Header="Detailed status"
                                                        Width="90"
                                                        MinWidth="90"
                                                        MaxWidth="90"
                                                        IsReadOnly="True">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="{Binding ShortStatus}"
                                                    Style="{StaticResource StatusButtonStyle}"
                                                    Click="StatusButton_Click"
                                                    Tag="{Binding}"
                                                    ToolTip="Click to see detailed status logs"
                                                    HorizontalAlignment="Stretch"
                                                    VerticalAlignment="Stretch" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- Action Bar -->
        <Border Grid.Row="2"
                Background="{StaticResource SEC_White}"
                BorderBrush="{StaticResource SEC_LightGrey}"
                BorderThickness="0,1,0,0">
            <Grid Margin="24,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Left group: Compatibility Check -->
                <StackPanel Grid.Column="0"
                            Orientation="Horizontal"
                            HorizontalAlignment="Left">
                    <Button x:Name="checkCompatibilityButton"
                            Content="🔍 Check Compatibility"
                            Command="{Binding CheckCompatibilityCommand}"
                            Visibility="{Binding IsCheckingCompatibility, Converter={StaticResource InverseBooleanToVisibilityConverter}, ConverterParameter=Invert}"
                            Style="{StaticResource PrimaryButtonStyle}" />

                    <Button x:Name="cancelCompatibilityButton"
                            Content="⏹️ Cancel Check"
                            Command="{Binding CancelCompatibilityCommand}"
                            Visibility="{Binding IsCheckingCompatibility, Converter={StaticResource BooleanToVisibilityConverter}}"
                            Style="{StaticResource DangerButtonStyle}" />
                </StackPanel>

                <!-- Right group: Configuration Actions -->
                <StackPanel Grid.Column="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button x:Name="sendNetworkButton"
                            Content="🌐 Send Network"
                            Command="{Binding SendNetworkConfigCommand}"
                            Style="{StaticResource SuccessButtonStyle}" />

                    <Button x:Name="sendNTPButton"
                            Content="🕐 Send NTP"
                            Command="{Binding SendNTPConfigCommand}"
                            Style="{StaticResource SuccessButtonStyle}" />
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>